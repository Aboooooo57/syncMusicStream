<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Music Player (Master)</title>
</head>
<body>
    <h1>WebSocket Music Player (Master)</h1>

    <label for="deviceId">Device ID:</label>
    <input type="text" id="deviceId" name="deviceId">
    <button onclick="registerDevice()">Register</button>

    <br><br>

    <audio id="audioPlayer" controls>
        <source src="/music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        var websocket = new WebSocket("ws://localhost:8001");
        var audioPlayer = document.getElementById("audioPlayer");
        var deviceIdInput = document.getElementById("deviceId");

        function registerDevice() {
            var deviceId = deviceIdInput.value;
            if (deviceId) {
                var message = "REGISTER_DEVICE:" + deviceId;
                websocket.send(message);
                console.log("Registered device:", deviceId);
            } else {
                console.log("Please provide a device ID.");
            }
        }

        audioPlayer.addEventListener("play", function() {
            var deviceId = deviceIdInput.value;
            if (deviceId) {
                var message = "PLAY:" + deviceId;
                websocket.send(message);
                console.log("Sent play command to all devices.");
            }
        });

        audioPlayer.addEventListener("pause", function() {
            var deviceId = deviceIdInput.value;
            if (deviceId) {
                var message = "PAUSE:" + deviceId;
                websocket.send(message);
                console.log("Sent pause command to all devices.");
            }
        });

        audioPlayer.addEventListener("timeupdate", function() {
            var deviceId = deviceIdInput.value;
            var position = audioPlayer.currentTime;
            if (deviceId) {
                var message = "UPDATE_POSITION:" + deviceId + ":" + position;
                websocket.send(message);
                console.log("Updated position for device:", deviceId, "Position:", position);
            }
        });

        websocket.onmessage = function(event) {
            var message = event.data;
            if (message.startsWith("playing:")) {
                // Extract the device ID from the message
                var deviceId = message.split(":")[1];
                console.log("Received play command for device:", deviceId);
                // Handle the play command here, for example:
                // Start playing the audio on this device
                audioPlayer.play();
            }
            else if (message.startsWith("paused:")){
                var deviceId = message.split(":")[1];
                console.log("Received paused command for device:", deviceId);
                audioPlayer.pause();
            }
        };
    </script>
</body>
</html>
